<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <title>포스트 작성</title>
    <link rel="stylesheet" href="/css/style.css" />
  </head>
  <body>
    <div class="bg"></div>

    <div class="wrapper">
      <div class="card">
        <h1 class="title">포스트 작성</h1>

        <form id="form">
          <!-- <div class="form-group">
            <input id="titleInput" name="title" required />
            <label>제목</label>
          </div> -->

          <div class="form-group">
            <textarea
              id="contentInput"
              name="text"
              rows="6"
              required
            ></textarea>
            <label>내용</label>
          </div>

          <button class="primary-btn" type="submit">작성 완료</button>
        </form>
      </div>
    </div>

    <script>
      const id = new URLSearchParams(location.search).get("id");
      const token = localStorage.getItem("token");

      async function load() {
        const res = await fetch(`http://127.0.0.1:3000/post`);
        const p = await res.json();

        document.getElementById("titleInput").value = p.title;
        document.getElementById("contentInput").value = p.text;
      }

      document.getElementById("form").addEventListener("submit", async (e) => {
        e.preventDefault();
        const f = new FormData(e.target);

        const res = await fetch(`http://127.0.0.1:3000/post`, {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            Authorization: `Bearer ${token}`,
          },
          body: JSON.stringify({
            // title: f.get("title"),
            text: f.get("text"),
          }),
        });

        if (res.ok) {
          alert("작성 완료!");
          location.href = `post.html`;
        } else alert("작성 실패");
      });

      load();
    </script>
  </body>
</html>
